const { Responses } = require('../../utils/responses');
const {{pascalCase module}} = require('../models/{{pascalCase module}}'); // mongoose model

// GET ALL
const getAll{{pascalCase module}}DB = async (userId) => {
  try {
    const data = await {{pascalCase module}}.find({ userId }).lean();
    return data;
  } catch (error) {
    console.error(error);
    return [];
  }
};

// GET BY ID
const get{{pascalCase module}}ByIdDB = async (userId, id) => {
  try {
    const data = await {{pascalCase module}}.findOne({ _id: id, userId }).lean();

    if (!data) {
      return [];
    }

    return data;
  } catch (error) {
    console.error(error);
    return [];
  }
};

// CREATE
const create{{pascalCase module}}DB = async (userId, payload) => {
  try {
    const data = await {{pascalCase module}}.create({
      ...payload,
      userId,
    });

    if (!data) {
      return Responses.badRequest;
    }

    return Responses.success;
  } catch (error) {
    console.error(error);
    return Responses.tryAgain;
  }
};

// UPDATE BY ID
const update{{pascalCase module}}ByIdDB = async (userId, id, payload) => {
  try {
    const result = await {{pascalCase module}}.updateOne(
      { _id: id, userId },
      { $set: payload }
    );

    if (result.matchedCount === 0) {
      return Responses.notFound;
    }

    return Responses.success;
  } catch (error) {
    console.error(error);
    return Responses.tryAgain;
  }
};

// DELETE BY ID
const delete{{pascalCase module}}ByIdDB = async (userId, id) => {
  try {
    const result = await {{pascalCase module}}.deleteOne({ _id: id, userId });

    if (result.deletedCount === 0) {
      return Responses.notFound;
    }

    return Responses.success;
  } catch (error) {
    console.error(error);
    return Responses.tryAgain;
  }
};

module.exports = {
  getAll{{pascalCase module}}DB,
  get{{pascalCase module}}ByIdDB,
  create{{pascalCase module}}DB,
  update{{pascalCase module}}ByIdDB,
  delete{{pascalCase module}}ByIdDB,
};
